# 📋 変更履歴

このドキュメントでは、プロジェクトのバージョンごとの開発者向けの変更内容を記録しています。

**📝 ユーザ向け情報は [RELEASE_NOTES.md](RELEASE_NOTES.md) をご覧ください。**


## [internal update] - 2025-11-16
※このセクションは内部的な変更履歴です
### 🏗️ コマンドハンドラーの分割

- **保守性向上**: 各コマンドを独立したファイルで管理
  - `internal/commands/handlers.go`: ルーティングのみを担当
  - `internal/commands/cmd_reserve.go`: `/reserve` コマンド
  - `internal/commands/cmd_cancel.go`: `/cancel` コマンド
  - `internal/commands/cmd_complete.go`: `/complete` コマンド
  - `internal/commands/cmd_edit.go`: `/edit` コマンド
  - `internal/commands/cmd_list.go`: `/list` コマンド
  - `internal/commands/cmd_my_reservations.go`: `/my-reservations` コマンド
  - `internal/commands/cmd_help.go`: `/help` コマンド
  - `internal/commands/cmd_feedback.go`: `/feedback` コマンド
  - `internal/commands/response_helpers.go`: 共通レスポンス関数

### 🔧 main.goのリファクタリング

- **設定値の一元管理**: すべての設定定数をファイル冒頭に集約
  ```go
  const (
      saveInterval       = 5 * time.Minute
      logCleanupInterval = 24 * time.Hour
      autoCompleteHour   = 3
      autoCompleteMinute = 0
      cleanupHour        = 3
      cleanupMinute      = 10
      retentionDays      = 30
  )
  ```
- **関数の分割**: 大きな`main`関数を複数の小さな関数に分割
  - `initializeServices()`: サービス初期化
  - `setupHandlers()`: イベントハンドラー設定
  - `startBackgroundTasks()`: バックグラウンドタスク起動
  - `periodicSave()`: 定期保存
  - `periodicLogCleanup()`: ログクリーンアップ
  - `dailyAutoComplete()`: 自動完了処理
  - `dailyCleanup()`: データクリーンアップ
  - `deleteExistingCommands()`: 既存コマンド削除
  - `getCommandDefinitions()`: コマンド定義取得
- **コードの可読性向上**: 各関数が単一の責任を持つように整理

### 🔧 技術的改善

- **コード重複排除**: DRY原則に基づいたリファクタリング
- **ファイル分割**: 大きなハンドラーファイルをコマンドごとに分割
- **可読性向上**: 各ファイルが単一責任を持つように整理
- **保守性向上**: 設定変更が容易に

### 📚 ドキュメント更新

- **DEVELOPMENT.md**: 新しいコマンド追加方法を更新
- **README.md**: プロジェクト構造の説明を更新
- **DATA_MANAGEMENT.md**: カスタマイズセクションを最新の構造に更新

📖 **この変更は内部構造の改善であり、機能変更はありません**


## [internal update] - 2025-11-16
※このセクションは内部的な変更履歴です
### 🏗️ プロジェクト構造の大規模リファクタリング

- **Go標準レイアウト採用**: プロジェクト構造を Go コミュニティ推奨のレイアウトに変更
  - `cmd/bot/main.go`: アプリケーションエントリーポイント
  - `internal/`: プライベートアプリケーションコード（外部インポート不可）
    - `internal/commands/`: コマンドハンドラー群
    - `internal/models/`: データモデル
    - `internal/storage/`: データ永続化
    - `internal/logging/`: ロギング機能

### 🔧 技術的改善

- **保守性向上**: コードの役割分離が明確化
- **拡張性向上**: 将来的にCLIツールなど複数バイナリの追加が容易
- **セキュリティ向上**: `internal/`により意図しない外部利用を防止

### 📚 ドキュメント更新

- **README.md**: 新しいディレクトリ構造を反映、設計思想を追加
- **DEVELOPMENT.md**: 開発者向けガイドを最新の構造に更新
- **すべてのコマンド例**: `main.go` → `cmd/bot/main.go` に更新

### 🔄 移行詳細

- すべての`.go`ファイルを新しい構造に移行
- インポートパスを`internal/`プレフィックスに更新
- Makefileのビルドコマンドを更新
- 旧ディレクトリ構造のクリーンアップ完了

📖 **internal update は内部構造の改善であり、機能変更はありません**


## [v1.3.1] - 2025-11-12

### ✨ 新機能

- **複数メッセージページネーション**: 10件以上の予約を複数メッセージに自動分割
- **フッター統一**: すべての埋め込みメッセージに「部室予約システム | コマンド名」形式のフッターを追加

### 🎨 UI/UX改善

- **進捗表示**: リストコマンドで「予約 X/Y」形式の進捗を表示
- **Ephemeral徹底**: すべてのページが実行者のみに表示

### 🔧 システム改善

- **コマンド登録エラー処理**: 一部のコマンド登録が失敗しても他のコマンドは登録継続

📖 **[v1.3.1 詳細リリースノート](releases/v1.3.1.md)**


## [v1.3.0] - 2025-11-12

### ✨ 新機能

- **埋め込みメッセージ化**: すべてのコマンド応答を見やすい埋め込み形式に変更

### 🎨 デザイン改善

- **カラーコード統一**: 各コマンドに適切な色を設定（緑/黄/赤/青/白/黒）
- **統一フォーマット**: タイトル、フィールド、タイムスタンプで構成
- **視認性向上**: 絵文字と色分けで一目で状態を判断可能

📖 **[v1.3.0 詳細リリースノート](releases/v1.3.0.md)**



## [v1.2.0] - 2025-11-12

### ✨ 新機能

#### `/edit` コマンド
- 既存の予約を編集可能に
- 日付、開始時刻、終了時刻、コメントを変更
- 部分的な編集にも対応

### 🛡️ 安全機能

- 編集時の重複チェック
- 過去日時への編集をブロック

### 🔔 通知機能

- 編集者へのプライベート通知（変更内容の詳細）
- チャンネルへの公開通知

📖 **[v1.2.0 詳細リリースノート](releases/v1.2.0.md)**



## [v1.1.0] - 2025-11-12

### ✨ 新機能

#### オートコンプリート機能
- **日付入力**: 「今日」「明日」「1週間後」などの候補を表示
- **時刻入力**: 09:00〜21:00の30分刻みで候補を表示
- **スマート候補**: 終了時刻は開始時刻より後の時刻のみ表示

### 🎯 対象コマンド

- `/reserve` - 予約作成

📖 **[v1.1.0 詳細リリースノート](releases/v1.1.0.md)**



## [v1.0.1] - 2025-11-12

### 🔧 改善

#### クリーンアップタイミングの最適化
- **変更前**: Bot起動時刻から24時間ごとに実行
- **変更後**: 毎日午前3時/3時10分に実行

#### 起動時の即時クリーンアップ
- Bot起動が深夜0時〜0時5分の場合、即座にクリーンアップを実行

### � バグ修正

- 起動時のクリーンアップ判定処理の無限ループを修正

📖 **[v1.0.1 詳細リリースノート](releases/v1.0.1.md)**


## [v1.0.0] - 2025-11-11

### 🎉 正式リリース

正式版リリースしました。

### ✨ 基本機能

#### 予約管理コマンド
- **`/reserve`** - 予約作成
- **`/cancel`** - 予約キャンセル
- **`/complete`** - 予約完了

#### 表示コマンド
- **`/list`** - すべての予約を表示
- **`/my-reservations`** - 自分の予約を表示

#### サポートコマンド
- **`/help`** - ヘルプ表示
- **`/feedback`** - 完全匿名フィードバック送信

### 🔧 システム機能

- **自動クリーンアップ**: 期限切れ予約の自動完了、古いデータの自動削除
- **データ永続化**: JSON形式で保存、5分ごとに自動保存
- **ログシステム**: コマンドログ、統計情報
- **環境分離**: 開発/本番環境の分離

📖 **[v1.0.0 詳細リリースノート](releases/v1.0.0.md)**


## バージョン番号の規則

このプロジェクトは [Semantic Versioning](https://semver.org/) に従います。

- **MAJOR** (例: v2.0.0): 後方互換性のない変更
- **MINOR** (例: v1.2.0): 後方互換性のある機能追加
- **PATCH** (例: v1.0.1): 後方互換性のあるバグ修正や小規模改善


## 📖 詳細なリリースノート

各バージョンの詳細な情報は [RELEASE_NOTES.md](RELEASE_NOTES.md) をご覧ください。



## 💡 フィードバック

バグ報告や機能要望は、Discord Botの `/feedback` コマンドでお送りください（完全匿名）。

---

**最終更新**: 2025-11-16
